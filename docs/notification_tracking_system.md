# توثيق نظام الإشعارات وتتبع الطلبات

## تحديثات النظام - مايو 2025

### نظام تتبع حالة الطلبات
تم تطوير وتحسين نظام تتبع حالة الطلبات ليشمل المميزات التالية:

1. **سجل تغييرات الحالة**
   - تتبع كامل لجميع تغييرات حالة الطلب
   - تخزين معلومات المستخدم الذي قام بالتغيير
   - حفظ تاريخ ووقت كل تغيير
   - إمكانية إضافة ملاحظات مع كل تغيير

2. **الإشعارات التلقائية**
   - إرسال إشعارات تلقائية عند تغيير حالة الطلب
   - تخصيص رسائل الإشعارات حسب نوع التغيير
   - دعم الإشعارات متعددة اللغات
   - إمكانية تحديد أولوية الإشعار (عالية، متوسطة، منخفضة)

3. **واجهة المستخدم**
   - نموذج سهل الاستخدام لتحديث حالة الطلب
   - عرض مرئي لسجل التغييرات باستخدام timeline
   - عرض تفاصيل كل تغيير مع الملاحظات والمعلومات الكاملة

### حالات تتبع الطلب
النظام يدعم الحالات التالية للطلب:

- `pending`: قيد الانتظار
- `processing`: قيد المعالجة
- `warehouse`: في المستودع
- `factory`: في المصنع
- `cutting`: قيد القص
- `ready`: جاهز للتسليم
- `delivered`: تم التسليم

### نموذج البيانات

#### OrderStatusLog
```python
class OrderStatusLog(models.Model):
    order = models.ForeignKey(Order, on_delete=models.CASCADE)
    old_status = models.CharField(max_length=20)
    new_status = models.CharField(max_length=20)
    changed_by = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)
    notes = models.TextField(blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
```

### نظام الإشعارات

#### أنواع الإشعارات
- إشعارات تغيير الحالة
- إشعارات الدفعات المالية
- إشعارات المعاينة والتركيب
- إشعارات المتابعة والتذكير

#### مستويات الأولوية
- `high`: للتغييرات المهمة مثل اكتمال الطلب أو جاهزيته للتسليم
- `medium`: للتحديثات العادية في حالة الطلب
- `low`: للتحديثات الإعلامية العامة

### دليل الاستخدام

#### تحديث حالة الطلب
1. الانتقال إلى صفحة تفاصيل الطلب
2. البحث عن قسم "تحديث حالة الطلب"
3. اختيار الحالة الجديدة من القائمة المنسدلة
4. إضافة ملاحظات (اختياري)
5. النقر على زر "تحديث الحالة"

#### تتبع التغييرات
- يمكن مشاهدة جميع التغييرات في قسم "سجل تغييرات الحالة"
- يتم عرض التغييرات بترتيب زمني من الأحدث للأقدم
- كل تغيير يعرض:
  - الحالة الجديدة
  - تاريخ ووقت التغيير
  - المستخدم الذي قام بالتغيير
  - الملاحظات المضافة (إن وجدت)

### التكامل مع الأنظمة الأخرى

#### تكامل مع نظام المخزون
- تحديث حالة المنتجات عند تغيير حالة الطلب
- إرسال إشعارات للمستودع عند الحاجة لتجهيز المنتجات

#### تكامل مع نظام المعاينات
- إنشاء معاينة تلقائياً عند طلب خدمة المعاينة
- ربط المعاينة بالطلب الأصلي
- تتبع حالة المعاينة وتحديث حالة الطلب تبعاً لها

### تحسينات مستقبلية مقترحة

1. **تحسينات الواجهة**
   - إضافة رسوم بيانية لتتبع تقدم الطلب
   - إضافة خريطة حرارية لتوزيع الطلبات حسب الحالة

2. **تحسينات وظيفية**
   - إضافة توقعات زمنية لكل مرحلة
   - إضافة نظام تنبيهات للتأخير
   - إضافة خاصية التحديث التلقائي للحالة

3. **تكامل إضافي**
   - ربط مع نظام توصيل خارجي
   - إضافة خاصية التتبع على الخريطة
   - إضافة واجهة برمجة تطبيقات (API) للتكامل مع أنظمة خارجية