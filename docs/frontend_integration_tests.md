# توثيق اختبارات التكامل للواجهة الأمامية

## نظرة عامة

تم تطوير مجموعة شاملة من اختبارات التكامل للتأكد من أن الواجهة الأمامية المطورة باستخدام React تتكامل بشكل صحيح مع واجهة برمجة التطبيقات (API) في الجزء الخلفي. هذه الاختبارات تغطي المكونات الرئيسية التي تم تطويرها في المرحلة الأولى من خطة الترقية وتضمن أنها تعمل كما هو متوقع عند التفاعل مع البيانات الحقيقية.

## الهيكل

تنقسم اختبارات التكامل إلى ثلاث فئات رئيسية:

1. **اختبارات خدمات API**: تختبر الخدمات التي تتواصل مباشرة مع واجهة برمجة التطبيقات
2. **اختبارات سيناريوهات الخطأ**: تضمن التعامل الصحيح مع حالات الخطأ المختلفة
3. **اختبارات تكامل المكونات**: تختبر تفاعل مكونات واجهة المستخدم مع خدمات API

## التقنيات المستخدمة

- **Vitest**: إطار الاختبار الرئيسي
- **React Testing Library**: لاختبار مكونات React
- **MSW (Mock Service Worker)**: لمحاكاة استجابات API أثناء الاختبار
- **Jest**: لتوفير وظائف المحاكاة والتحقق

## كيفية تشغيل الاختبارات

لتشغيل جميع اختبارات التكامل:

```bash
cd frontend
npm run test:integration
```

لتشغيل مجموعة محددة من الاختبارات:

```bash
cd frontend
npm run test:integration -- -t "اسم الاختبار أو نمط"
```

## اختبارات خدمات API

### نظام المصادقة (`authService`)

| الاختبار | الوصف |
|---------|-------|
| `يجب أن يقوم بتسجيل الدخول ويعيد الرموز المميزة للمصادقة` | يتحقق من أن خدمة تسجيل الدخول تعود بالرموز المميزة الصحيحة |
| `يجب أن يقوم بتحديث رمز الوصول` | يتأكد من أن خدمة تحديث الرمز تعمل بشكل صحيح |

### لوحة التحكم (`dashboardService`)

| الاختبار | الوصف |
|---------|-------|
| `يجب أن يجلب إحصائيات لوحة التحكم` | يتحقق من استرجاع بيانات الإحصائيات الصحيحة |
| `يجب أن يجلب النشاطات الأخيرة` | يتحقق من استرجاع بيانات النشاطات الأخيرة |
| `يجب أن يجلب الطلبات الأخيرة` | يتحقق من استرجاع بيانات الطلبات الأخيرة |
| `يجب أن يجلب المهام النشطة` | يتحقق من استرجاع بيانات المهام النشطة |

### إدارة المستخدمين (`userService`)

| الاختبار | الوصف |
|---------|-------|
| `يجب أن يجلب قائمة المستخدمين` | يتحقق من استرجاع بيانات المستخدمين |
| `يجب أن يجلب بيانات مستخدم محدد` | يتأكد من استرجاع بيانات مستخدم محدد بناءً على المعرّف |
| `يجب أن ينشئ مستخدم جديد` | يتحقق من إنشاء مستخدم جديد بنجاح |
| `يجب أن يقوم بتحديث بيانات مستخدم` | يتحقق من تحديث بيانات مستخدم موجود |
| `يجب أن يحذف مستخدم` | يتحقق من حذف مستخدم بنجاح |
| `يجب أن يعيد تعيين كلمة المرور لمستخدم` | يتحقق من إعادة تعيين كلمة المرور بنجاح |
| `يجب أن يجلب قائمة الأدوار` | يتحقق من استرجاع قائمة الأدوار المتاحة |

## اختبارات سيناريوهات الخطأ

### أخطاء المصادقة

| الاختبار | الوصف |
|---------|-------|
| `يجب إرجاع خطأ عند فشل تسجيل الدخول` | يتحقق من التعامل الصحيح مع بيانات اعتماد غير صحيحة |
| `يجب إرجاع خطأ عند فشل تحديث الرمز` | يتحقق من التعامل الصحيح مع رمز تحديث غير صالح |

### أخطاء لوحة التحكم

| الاختبار | الوصف |
|---------|-------|
| `يجب إرجاع خطأ عند فشل جلب إحصائيات لوحة التحكم` | يتحقق من التعامل الصحيح مع خطأ خادم عند استرجاع البيانات |

### أخطاء إدارة المستخدمين

| الاختبار | الوصف |
|---------|-------|
| `يجب إرجاع خطأ عند جلب مستخدم غير موجود` | يتحقق من التعامل الصحيح مع طلب مستخدم غير موجود |
| `يجب إرجاع أخطاء التحقق عند إنشاء مستخدم بمعلومات مكررة` | يتحقق من التعامل الصحيح مع أخطاء التحقق من البيانات |

## اختبارات تكامل المكونات

### مكون لوحة التحكم (`Dashboard`)

| الاختبار | الوصف |
|---------|-------|
| `يجب عرض بيانات لوحة التحكم من API` | يتحقق من عرض بيانات API بشكل صحيح في لوحة التحكم |
| `يجب عرض مؤشر التحميل أثناء استدعاء البيانات من API` | يتحقق من عرض مؤشر التحميل أثناء جلب البيانات |
| `يجب عرض رسالة الخطأ عند فشل استدعاء البيانات من API` | يتحقق من عرض رسالة خطأ عند فشل جلب البيانات |

### مكون قائمة المستخدمين (`UsersList`)

| الاختبار | الوصف |
|---------|-------|
| `يجب عرض قائمة المستخدمين من API` | يتحقق من عرض بيانات المستخدمين المسترجعة من API |
| `يجب استدعاء وظيفة الحذف عند النقر على زر الحذف وتأكيد الإجراء` | يتحقق من استدعاء API الحذف عند تأكيد الإجراء |

### مكون تعديل المستخدم (`UserEdit`)

| الاختبار | الوصف |
|---------|-------|
| `يجب عرض بيانات المستخدم للتعديل من API` | يتحقق من عرض بيانات المستخدم المسترجعة من API |
| `يجب عرض مؤشر التحميل عند جلب بيانات المستخدم` | يتحقق من عرض مؤشر التحميل أثناء جلب البيانات |
| `يجب عرض رسالة خطأ عند فشل جلب بيانات المستخدم` | يتحقق من عرض رسالة خطأ عند فشل جلب البيانات |

## اختبارات خاصة

### التعامل مع الرموز المميزة وتجديدها

| الاختبار | الوصف |
|---------|-------|
| `يجب تجديد الرمز وإعادة المحاولة عند انتهاء صلاحيته` | يتحقق من آلية تجديد الرمز المميز عند انتهاء الصلاحية |

### التعامل مع البيانات العربية

| الاختبار | الوصف |
|---------|-------|
| `يجب التعامل مع البيانات العربية بشكل صحيح` | يتأكد من معالجة وعرض البيانات العربية بشكل صحيح دون مشاكل ترميز |

### معلمات الاستعلام

| الاختبار | الوصف |
|---------|-------|
| `يجب التأكد من أن الخدمات تتعامل مع معلمات الاستعلام بشكل صحيح` | يتحقق من إرسال واستقبال معلمات الاستعلام بشكل صحيح |

## حالات الخاصة

### الصفحات الفارغة

تم اختبار سيناريوهات عرض الصفحات عندما لا توجد بيانات للتأكد من عرض رسائل مناسبة للمستخدم.

### التحقق من الإدخال

تم اختبار سيناريوهات التحقق من الإدخال للتأكد من أن النماذج تقوم بالتحقق من البيانات بشكل صحيح قبل إرسالها.

## التحسينات والإصلاحات الأخيرة (07-05-2025)

### 1. تحديث الاختبارات للتوافق مع Vitest
- تم تحديث جميع الاختبارات لاستخدام Vitest بدلاً من Jest
- إضافة وتكوين @testing-library/jest-dom للمطابقات الخاصة بـ DOM
- تحسين محاكاة MSW لتستخدم http و HttpResponse

### 2. تحسين معالجة التواريخ
- تحديث وظيفة formatDate للتعامل مع التواريخ كسلاسل نصية أو كائنات Date
- تحسين اختبارات التكامل لمعالجة التواريخ بشكل أفضل
- دعم أفضل للتنسيقات المختلفة للتواريخ

### 3. إصلاح مشكلات الرسوم البيانية
- إضافة محاكاة ResizeObserver لدعم Chart.js في بيئة الاختبار
- تحسين اختبارات مكونات الرسوم البيانية
- معالجة مشكلات التوافق مع JSDOM

### 4. نتائج التحسينات
- نجاح جميع الـ 27 اختباراً (19 اختبار API و 8 اختبارات مكونات)
- تحسين موثوقية الاختبارات وتقليل النتائج الكاذبة
- تغطية أفضل لسيناريوهات الخطأ والحالات الحدية

## تحسينات مستقبلية

1. **زيادة تغطية الاختبارات**: توسيع نطاق الاختبارات لتشمل المزيد من السيناريوهات
2. **اختبارات أداء E2E**: إضافة اختبارات نهاية إلى نهاية لقياس الأداء
3. **اختبارات تكامل متقدمة**: تطوير اختبارات تكامل أكثر تعقيدًا تغطي تدفقات العمل الكاملة
4. **اختبارات توافق المتصفحات**: التأكد من عمل التطبيق بشكل صحيح على متصفحات مختلفة

## ملاحظات للمطورين

- يمكنك إضافة اختبارات جديدة باستخدام الأنماط الموجودة في الملفات الحالية
- تأكد من تحديث هذا التوثيق عند إضافة اختبارات جديدة
- لاختبار مكونات واجهة مستخدم جديدة، اتبع نمط اختبارات المكونات الحالية