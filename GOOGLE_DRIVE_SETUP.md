# 📋 دليل إعداد نظام Google Drive للمعاينات

## 🎯 نظرة عامة

تم تطوير نظام متكامل لرفع ملفات المعاينات تلقائياً إلى Google Drive مع تتبع فوري وإدارة شاملة من خلال قسم إدارة البيانات.

## ✨ الميزات الرئيسية

### 🔄 **الرفع التلقائي:**
- رفع مباشر إلى Google Drive فور اختيار الملف
- تسمية ذكية للملفات: `اسم_العميل_الفرع_التاريخ_رقم_الطلب.pdf`
- تتبع فوري مع شريط تقدم باستخدام SweetAlert

### 📊 **إدارة الإعدادات:**
- واجهة سهلة في قسم إدارة البيانات
- اختبار الاتصال مع Google Drive
- إحصائيات الاستخدام والرفع

### 🔗 **التحميل المباشر:**
- روابط مباشرة لمعاينة الملفات في Google Drive
- إمكانية التحميل من Google Drive مباشرة

---

## 🛠️ خطوات الإعداد

### **الخطوة 1: إنشاء مشروع Google Cloud**

1. **انتقل إلى Google Cloud Console:**
   - اذهب إلى: https://console.cloud.google.com/

2. **إنشاء مشروع جديد:**
   - انقر على "إنشاء مشروع"
   - أدخل اسم المشروع (مثل: "CRM-Inspections")
   - انقر على "إنشاء"

### **الخطوة 2: تفعيل Google Drive API**

1. **في لوحة التحكم:**
   - انتقل إلى "APIs & Services" > "Library"
   - ابحث عن "Google Drive API"
   - انقر على "تفعيل"

### **الخطوة 3: إنشاء Service Account**

1. **انتقل إلى Credentials:**
   - "APIs & Services" > "Credentials"
   - انقر على "إنشاء Credentials" > "Service Account"

2. **تعبئة البيانات:**
   - **اسم الحساب:** CRM-Inspections-Service
   - **الوصف:** خدمة رفع ملفات المعاينات
   - انقر على "إنشاء والمتابعة"

3. **تعيين الأدوار:**
   - اختر "Editor" أو "Storage Admin"
   - انقر على "متابعة" ثم "تم"

### **الخطوة 4: تحميل ملف الاعتماد**

1. **في صفحة Service Accounts:**
   - انقر على الحساب المُنشأ
   - انتقل إلى تبويب "Keys"
   - انقر على "Add Key" > "Create New Key"
   - اختر "JSON" وانقر على "Create"
   - احفظ الملف بأمان

### **الخطوة 5: إنشاء مجلد Google Drive**

1. **في Google Drive:**
   - انشئ مجلد جديد (مثل: "ملفات المعاينات")
   - انقر بالزر الأيمن على المجلد > "مشاركة"

2. **مشاركة المجلد:**
   - أضف البريد الإلكتروني للـ Service Account
   - (موجود في ملف JSON تحت `client_email`)
   - اعطه صلاحية "Editor"

3. **نسخ معرف المجلد:**
   - من رابط المجلد: `https://drive.google.com/drive/folders/FOLDER_ID`
   - انسخ `FOLDER_ID`

---

## ⚙️ إعداد النظام

### **1. الدخول إلى إعدادات Google Drive:**
```
http://your-domain.com/odoo-db-manager/google-drive/settings/
```

### **2. تعبئة النموذج:**

#### **معلومات المجلد:**
- **معرف مجلد المعاينات:** الصق `FOLDER_ID` المنسوخ
- **اسم مجلد المعاينات:** "ملفات المعاينات"

#### **ملف الاعتماد:**
- ارفع ملف JSON المحمل من Google Cloud

#### **الإعدادات:**
- **تفعيل الخدمة:** ✅ مفعل

### **3. اختبار الاتصال:**
- انقر على "اختبار الاتصال"
- يجب أن تظهر رسالة نجاح

---

## 🚀 كيفية الاستخدام

### **رفع ملف جديد:**

1. **في نموذج المعاينة:**
   - اختر ملف PDF في حقل "ملف المعاينة"
   - سيظهر شريط تقدم تلقائياً
   - ستظهر رسالة نجاح مع رابط Google Drive

2. **التسمية التلقائية:**
   ```
   احمد_محمد_فرع_القاهرة_2024-01-15_ORD-001.pdf
   ```

### **عرض الملفات:**

1. **في صفحة تفاصيل المعاينة:**
   - رابط "عرض ملف المعاينة (محلي)"
   - رابط "عرض في Google Drive"

2. **الرفع اليدوي:**
   - زر "رفع إلى Google Drive" للملفات غير المرفوعة

---

## 📊 الإحصائيات والمراقبة

### **في صفحة الإعدادات:**
- **إجمالي الرفعات:** عدد الملفات المرفوعة
- **آخر رفع:** تاريخ ووقت آخر رفع
- **حالة الاتصال:** متصل/غير متصل

### **سجل العمليات:**
- تتبع جميع عمليات الرفع
- رسائل الأخطاء والحلول
- إحصائيات الاستخدام

---

## 🔧 استكشاف الأخطاء

### **خطأ: "فشل في تهيئة خدمة Google Drive"**
**الحل:**
1. تأكد من رفع ملف JSON صحيح
2. تحقق من تفعيل Google Drive API
3. تأكد من صحة معرف المجلد

### **خطأ: "فشل الاتصال"**
**الحل:**
1. تحقق من مشاركة المجلد مع Service Account
2. تأكد من صلاحيات "Editor" للحساب
3. تحقق من اتصال الإنترنت

### **خطأ: "معرف المجلد غير صحيح"**
**الحل:**
1. انسخ معرف المجلد من الرابط مباشرة
2. تأكد من عدم وجود مسافات إضافية
3. تحقق من أن المجلد موجود ومتاح

---

## 🔒 الأمان والخصوصية

### **حماية ملف الاعتماد:**
- يتم تخزين ملف JSON بشكل آمن
- لا يتم عرض محتويات الملف في الواجهة
- صلاحيات محدودة للـ Service Account

### **صلاحيات الوصول:**
- فقط المستخدمين المخولين يمكنهم الوصول للإعدادات
- تتبع جميع العمليات مع معرف المستخدم
- سجل شامل للأنشطة

---

## 📈 التحسينات المستقبلية

### **ميزات مخططة:**
- رفع متعدد الملفات
- ضغط الملفات تلقائياً
- نسخ احتياطية دورية
- تكامل مع Google Sheets
- إشعارات البريد الإلكتروني

### **تحسينات الأداء:**
- رفع متوازي للملفات
- تخزين مؤقت للبيانات
- ضغط الصور والملفات
- تحسين سرعة الرفع

---

## 📞 الدعم الفني

### **في حالة وجود مشاكل:**
1. تحقق من سجل الأخطاء في الإعدادات
2. اختبر الاتصال مع Google Drive
3. راجع دليل استكشاف الأخطاء
4. تواصل مع فريق الدعم الفني

### **معلومات مفيدة للدعم:**
- رسالة الخطأ الكاملة
- وقت حدوث المشكلة
- خطوات إعادة إنتاج المشكلة
- لقطة شاشة للخطأ

---

## ✅ قائمة التحقق النهائية

- [ ] إنشاء مشروع Google Cloud
- [ ] تفعيل Google Drive API
- [ ] إنشاء Service Account
- [ ] تحميل ملف JSON
- [ ] إنشاء مجلد Google Drive
- [ ] مشاركة المجلد مع Service Account
- [ ] رفع ملف الاعتماد في النظام
- [ ] تعبئة معرف المجلد
- [ ] اختبار الاتصال بنجاح
- [ ] تجربة رفع ملف تجريبي

**🎉 تهانينا! نظام Google Drive جاهز للاستخدام**
